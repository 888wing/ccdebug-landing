/*! For license information please see background.js.LICENSE.txt */
(()=>{var e={702:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,s=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){s=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(s)throw o}}return c}}(e,t)||n(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function a(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function c(r,n,o,a){var c=n&&n.prototype instanceof s?n:s,l=Object.create(c.prototype);return i(l,"_invoke",function(r,n,o){var a,i,c,s=0,l=o||[],f=!1,y={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return a=t,i=0,c=e,y.n=r,u}};function p(r,n){for(i=r,c=n,t=0;!f&&s&&!o&&t<l.length;t++){var o,a=l[t],p=y.p,d=a[2];r>3?(o=d===n)&&(c=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=r<2&&p<a[1])?(i=0,y.v=n,y.n=a[1]):p<d&&(o=r<3||a[0]>n||n>d)&&(a[4]=r,a[5]=n,y.n=d,i=0))}if(o||r>1)return u;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,d),i=l,c=d;(t=i<2?e:c)||!f;){a||(i?i<3?(i>1&&(y.n=-1),p(i,c)):y.n=c:y.v=c);try{if(s=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(f=y.n<0)?c:r.call(n,y))!==u)break}catch(t){a=e,i=1,c=t}finally{s=1}}return{value:t,done:f}}}(r,o,a),!0),l}var u={};function s(){}function l(){}function f(){}t=Object.getPrototypeOf;var y=[][n]?t(t([][n]())):(i(t={},n,function(){return this}),t),p=f.prototype=s.prototype=Object.create(y);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,i(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=f,i(p,"constructor",f),i(f,"constructor",l),l.displayName="GeneratorFunction",i(f,o,"GeneratorFunction"),i(p),i(p,o,"Generator"),i(p,n,function(){return this}),i(p,"toString",function(){return"[object Generator]"}),(a=function(){return{w:c,m:d}})()}function i(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}i=function(e,t,r,n){function a(t,r){i(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},i(e,t,r,n)}function c(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function u(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){c(a,n,o,i,u,"next",e)}function u(e){c(a,n,o,i,u,"throw",e)}i(void 0)})}}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,l(n.key),n)}}function l(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}importScripts("../lib/api-client.js");var f=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.errors=new Map,this.analyses=new Map,this.apiClient=new CCDebuggerAPI,this.init()},t=[{key:"init",value:(f=u(a().m(function e(){var t,r=this;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,chrome.storage.sync.get({apiEndpoint:"https://api.ccdebugger.com",apiKey:null,enableMonitoring:!0,language:"en"});case 1:t=e.v,this.apiClient.setConfig({endpoint:t.apiEndpoint,apiKey:t.apiKey}),this.setupListeners(),chrome.tabs.onRemoved.addListener(function(e){r.errors.delete(e),r.analyses.delete(e)});case 2:return e.a(2)}},e,this)})),function(){return f.apply(this,arguments)})},{key:"setupListeners",value:function(){var e=this;chrome.runtime.onMessage.addListener(function(t,r,n){if("error_detected"===t.action&&r.tab)e.handleError(r.tab.id,t.error),n({success:!0});else if("get_errors"===t.action){var o=e.errors.get(t.tabId)||[];n({errors:o})}else if("clear_errors"===t.action)e.clearErrors(t.tabId),n({success:!0});else if("get_analysis"===t.action){var a=e.analyses.get(t.errorId);n({analysis:a})}else{if("analyze_error"===t.action)return e.analyzeError(t.error).then(function(e){n({analysis:e})}),!0;"devtools_runtime_error"!==t.action&&"devtools_network_error"!==t.action&&"devtools_console_error"!==t.action||(chrome.tabs.query({active:!0,currentWindow:!0},function(r){if(r[0]){var n=r[0].id;"devtools_runtime_error"===t.action&&e.handleError(n,t.error),chrome.runtime.sendMessage(t).catch(function(){})}}),n({success:!0}))}return!0}),chrome.tabs.onActivated.addListener(function(t){var r=t.tabId;e.updateBadge(r)}),chrome.commands.onCommand.addListener(function(t){"analyze-page"===t&&e.analyzeCurrentPage()}),chrome.runtime.onInstalled.addListener(function(){chrome.contextMenus.create({id:"analyze-selection",title:"Analyze Error with CCDebugger",contexts:["selection"]})}),chrome.contextMenus.onClicked.addListener(function(t,r){"analyze-selection"===t.menuItemId&&t.selectionText&&e.analyzeText(t.selectionText,r.id)})}},{key:"handleError",value:(l=u(a().m(function e(t,r){var n,o=this;return a().w(function(e){for(;;)switch(e.n){case 0:this.errors.has(t)||this.errors.set(t,[]),r.id="".concat(t,"_").concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),r.timestamp=r.timestamp||(new Date).toISOString(),(n=this.errors.get(t)).some(function(e){return e.message===r.message&&Math.abs(new Date(e.timestamp)-new Date(r.timestamp))<1e3})||(n.push(r),this.errors.set(t,n),this.updateBadge(t),this.analyzeError(r).then(function(e){e&&(o.analyses.set(r.id,e),chrome.runtime.sendMessage({action:"new_analysis",errorId:r.id,analysis:e}).catch(function(){}))}));case 1:return e.a(2)}},e,this)})),function(e,t){return l.apply(this,arguments)})},{key:"analyzeError",value:(c=u(a().m(function e(t){var r,n;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.apiClient.analyzeError(t);case 1:return r=e.v,e.a(2,r);case 2:return e.p=2,n=e.v,console.error("Failed to analyze error:",n),e.a(2,null)}},e,this,[[0,2]])})),function(e){return c.apply(this,arguments)})},{key:"updateBadge",value:function(e){var t=(this.errors.get(e)||[]).length;chrome.action.setBadgeText({text:t>0?t.toString():"",tabId:e}),chrome.action.setBadgeBackgroundColor({color:t>0?"#FF0000":"#00000000",tabId:e});var r=t>0?chrome.i18n.getMessage("errorCount",[t]):chrome.i18n.getMessage("noErrors");chrome.action.setTitle({title:r,tabId:e})}},{key:"clearErrors",value:function(e){this.errors.delete(e);var t,o=this.analyses,a=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=n(e))){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==t.return||t.return()}finally{if(c)throw a}}}}(o);try{for(a.s();!(t=a.n()).done;){var i=r(t.value,2),c=i[0];i[1],c.startsWith("".concat(e,"_"))&&o.delete(c)}}catch(e){a.e(e)}finally{a.f()}this.updateBadge(e)}},{key:"analyzeCurrentPage",value:(i=u(a().m(function e(){var t,n,o;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,chrome.tabs.query({active:!0,currentWindow:!0});case 1:t=e.v,n=r(t,1),(o=n[0])&&chrome.scripting.executeScript({target:{tabId:o.id},func:function(){window.postMessage({type:"CCDEBUGGER_ANALYZE"},"*")}});case 2:return e.a(2)}},e)})),function(){return i.apply(this,arguments)})},{key:"analyzeText",value:(o=u(a().m(function e(t,r){var n;return a().w(function(e){for(;;)switch(e.n){case 0:n={type:"manual_analysis",message:t,timestamp:(new Date).toISOString()},this.handleError(r,n);case 1:return e.a(2)}},e,this)})),function(e,t){return o.apply(this,arguments)})}],t&&s(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,o,i,c,l,f}();new f,e.exports&&(e.exports=f)}},t={};!function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}(702)})();